<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>StockScreener Dashboard</title>
<script src="https://cdn.plot.ly/plotly-2.35.2.min.js" charset="utf-8"></script>
<style>
:root { --green:#10B981; --red:#EF4444; --amber:#F59E0B;
    --blue:#3B82F6; --grey:#64748B; --dark:#0F172A;
    --card:#FFFFFF; --bg:#F1F5F9; --border:#E2E8F0;
    --sidebar-w:220px; }
* { margin:0; padding:0; box-sizing:border-box; }
html,body { height:100%; }
body { font-family:'Segoe UI',-apple-system,sans-serif; background:var(--bg);
    color:#1E293B; display:flex; }
.sidebar { position:fixed; top:0; left:0; width:var(--sidebar-w); height:100vh;
    background:var(--dark); overflow-y:auto; z-index:100;
    box-shadow:2px 0 10px rgba(0,0,0,0.3); display:flex; flex-direction:column; }
.sidebar-header { padding:18px 16px 12px; border-bottom:1px solid rgba(255,255,255,0.1); }
.sidebar-header h3 { color:white; font-size:14px; font-weight:700; letter-spacing:0.5px; }
.sidebar-header .subtitle { color:#64748B; font-size:10px; margin-top:2px; }
.tab-list { flex:1; padding:8px; }
.tab-btn { display:flex; align-items:center; justify-content:space-between;
    width:100%; background:transparent; border:none; color:#94A3B8;
    padding:8px 10px; border-radius:6px; cursor:pointer; font-size:12px;
    font-weight:500; text-align:left; transition:all 0.15s;
    font-family:inherit; gap:4px; position:relative; }
.tab-btn:hover { background:rgba(255,255,255,0.06); color:white; }
.tab-btn.active { background:var(--blue); color:white; font-weight:700; }
.tab-btn .ticker-name { flex:1; overflow:hidden; text-overflow:ellipsis; white-space:nowrap; }
.tab-btn .price-sm { font-size:10px; color:#64748B; white-space:nowrap; }
.tab-btn.active .price-sm { color:rgba(255,255,255,0.8); }
.tab-btn .grade-badge { font-size:9px; padding:1px 5px; border-radius:4px;
    color:white; font-weight:700; flex-shrink:0; }
.main-container { margin-left:var(--sidebar-w); width:calc(100% - var(--sidebar-w));
    max-width:1200px; padding:20px; min-width:0; }
.tab-pane { display:none; }
.stock-header { display:flex; justify-content:space-between; align-items:flex-start;
    flex-wrap:wrap; gap:12px; margin-bottom:20px;
    background:var(--card); border-radius:12px; padding:20px;
    box-shadow:0 1px 3px rgba(0,0,0,0.08); }
.stock-header h1 { font-size:22px; color:var(--dark); }
.stock-header .sub { font-size:12px; color:var(--grey); margin-top:2px; }
.price-block { text-align:right; }
.price-block .price { font-size:26px; font-weight:800; color:var(--dark); }
.price-block .meta { font-size:11px; color:var(--grey); }
.scorecard { display:grid; grid-template-columns:repeat(5,1fr); gap:8px;
    margin-bottom:16px; }
.score-card { background:var(--card); border-radius:10px; padding:14px;
    text-align:center; box-shadow:0 1px 3px rgba(0,0,0,0.06); }
.score-card .label { font-size:10px; color:var(--grey); text-transform:uppercase;
    letter-spacing:0.5px; margin-bottom:4px; }
.score-card .value { font-size:24px; font-weight:800; }
.score-card .desc { font-size:11px; color:var(--grey); margin-top:2px; }
.section { background:var(--card); border-radius:10px; padding:16px;
    margin-bottom:16px; box-shadow:0 1px 3px rgba(0,0,0,0.06); overflow-x:auto; }
.section h2 { font-size:14px; color:var(--dark); margin-bottom:10px;
    padding-bottom:6px; border-bottom:1px solid var(--border); }
.grid { display:grid; grid-template-columns:repeat(2,1fr); gap:12px;
    margin-bottom:16px; }
.grid-4 { display:grid; grid-template-columns:repeat(4,1fr); gap:10px;
    margin-bottom:16px; }
.charts-grid { display:grid; grid-template-columns:repeat(2,1fr); gap:12px;
    margin-bottom:16px; }
.chart-card { background:var(--card); border-radius:10px; padding:12px;
    box-shadow:0 1px 3px rgba(0,0,0,0.06); overflow:hidden; }
.sidebar-toggle { position:fixed; top:8px; left:var(--sidebar-w); z-index:101;
    width:44px; height:44px; border-radius:50%; border:1px solid var(--border);
    background:var(--card); cursor:pointer; display:flex; align-items:center;
    justify-content:center; font-size:12px; color:var(--grey);
    box-shadow:0 1px 4px rgba(0,0,0,0.15); transition:left 0.2s; }
body.sidebar-collapsed .sidebar { width:0; overflow:hidden; }
body.sidebar-collapsed .main-container { margin-left:0; width:100%; max-width:100%; }
body.sidebar-collapsed .sidebar-toggle { left:0; }

/* ── Medium: tablets 769–1024px ─────────────────────────────────────────── */
@media(max-width:1024px) {
    .scorecard { grid-template-columns:repeat(3,1fr); }
}

/* ── Small: large phones / small tablets 481–768px ──────────────────────── */
@media(max-width:768px) {
    :root { --sidebar-w:56px; }
    .sidebar-header h3,.tab-btn .ticker-name,.tab-btn .price-sm { display:none; }
    .sidebar-header .subtitle { display:none; }
    .tab-btn { justify-content:center; padding:10px 6px; }
    .main-container { padding:15px; }
    .scorecard { grid-template-columns:repeat(2,1fr); }
    .charts-grid { grid-template-columns:1fr; }
    .grid-4 { grid-template-columns:repeat(2,1fr); }
    .grid { grid-template-columns:1fr; }
}

/* ── Extra Small: phones ≤480px ─────────────────────────────────────────── */
@media(max-width:480px) {
    .main-container { padding:10px; max-width:100%; }
    .stock-header { flex-direction:column; align-items:flex-start; }
    .stock-header h1 { font-size:16px; }
    .price-block { text-align:left; }
    .price-block .price { font-size:20px; }
    .scorecard { grid-template-columns:repeat(2,1fr); }
    .score-card .value { font-size:18px; }
    .grid,.grid-4,.charts-grid { grid-template-columns:1fr; }
    .section { padding:10px; }
    .period-bar { flex-wrap:wrap; }
}

/* ── Extra Large: wide monitors >1440px ─────────────────────────────────── */
@media(min-width:1441px) {
    .main-container { max-width:1440px; }
}
.metric { display:flex; justify-content:space-between; padding:4px 0;
    border-bottom:1px solid #F1F5F9; font-size:13px; }
.metric .key { color:var(--grey); }
.metric .val { font-weight:600; }
.positive { color:var(--green); }
.negative { color:var(--red); }
.flag { padding:4px 10px; margin:3px 0; border-radius:6px; font-size:12px; }
.flag.green { background:#F0FDF4; color:#166534; border-left:3px solid var(--green); }
.flag.red { background:#FEF2F2; color:#991B1B; border-left:3px solid var(--red); }
.flag.amber { background:#FFFBEB; color:#92400E; border-left:3px solid var(--amber); }
.data-table { width:100%; border-collapse:collapse; font-size:12px; }
.data-table th { text-align:right; padding:4px 6px; background:#F8FAFC;
    color:var(--grey); font-size:11px; border-bottom:2px solid var(--border); }
.data-table td { text-align:right; padding:4px 6px; border-bottom:1px solid #F1F5F9; }
.data-table td:first-child,.data-table th:first-child { text-align:left; }
.bar-52w { height:6px; background:#E2E8F0; border-radius:3px; margin:6px 0; }
.bar-52w .fill { height:100%; border-radius:3px; }
.segment-tag { display:inline-block; background:#EBF5FF; color:var(--blue);
    padding:3px 10px; border-radius:16px; margin:3px; font-size:12px; }
.sh-bar { display:flex; height:20px; border-radius:6px; overflow:hidden; margin:8px 0; }
.sh-bar > div { display:flex; align-items:center; justify-content:center;
    font-size:10px; color:white; font-weight:600; }
.doc-item { padding:3px 0; font-size:12px; }
.doc-item a { color:var(--blue); text-decoration:none; }
.footer { text-align:center; color:var(--grey); font-size:11px; padding:12px; }
.footer a { color:var(--blue); text-decoration:none; }
.period-bar { display:flex; gap:4px; margin-bottom:8px; }
.period-btn { padding:5px 14px; border:1px solid var(--border); border-radius:6px;
    background:var(--card); cursor:pointer; font-size:12px; font-weight:600;
    color:var(--grey); font-family:inherit; transition:all 0.15s; }
.period-btn:hover { color:var(--dark); border-color:#94A3B8; }
.period-btn.active { background:var(--blue); color:white; border-color:var(--blue); }
.section-header { display:flex; align-items:center; padding:8px 12px;
    color:#94A3B8; font-size:10px; font-weight:700; text-transform:uppercase;
    letter-spacing:1.2px; cursor:pointer; user-select:none;
    border-bottom:1px solid rgba(255,255,255,0.05);
    transition:background 0.15s; }
.section-header:hover { background:rgba(255,255,255,0.03); }
.section-header .chevron { margin-right:6px; transition:transform 0.2s;
    font-size:8px; display:inline-block; }
.section-header.collapsed .chevron { transform:rotate(-90deg); }
.section-header .sec-count { margin-left:auto; color:#475569;
    font-size:9px; font-weight:400; }
.section-body { overflow:hidden; transition:max-height 0.3s ease; }
.section-body.collapsed { max-height:0 !important; overflow:hidden; }
.add-symbol { padding:8px; border-top:1px solid rgba(255,255,255,0.1); position:relative; }
.add-symbol input { width:100%; padding:7px 10px; border:1px solid rgba(255,255,255,0.15);
    border-radius:6px; background:rgba(255,255,255,0.07); color:white;
    font-size:12px; font-family:inherit; outline:none; }
.add-symbol input::placeholder { color:#64748B; }
.add-symbol input:focus { border-color:var(--blue); background:rgba(59,130,246,0.1); }
.add-symbol .hint { font-size:9px; color:#475569; margin-top:4px; padding:0 2px; }
.ac-dropdown { position:absolute; left:8px; right:8px; background:#1E293B;
    border:1px solid rgba(255,255,255,0.15); border-radius:6px; max-height:240px;
    overflow-y:auto; z-index:200; display:none; box-shadow:0 4px 12px rgba(0,0,0,0.4); }
.ac-item { padding:7px 10px; cursor:pointer; font-size:12px; color:#CBD5E1;
    display:flex; justify-content:space-between; align-items:center;
    border-bottom:1px solid rgba(255,255,255,0.05); }
.ac-item:last-child { border-bottom:none; }
.ac-item:hover,.ac-item.highlighted { background:rgba(59,130,246,0.2); color:white; }
.ac-item .ac-ticker { font-weight:700; color:white; }
.ac-item .ac-name { font-size:11px; color:#94A3B8; margin-left:8px;
    overflow:hidden; text-overflow:ellipsis; white-space:nowrap; flex:1; }
.tab-btn .del-btn { display:none; margin-left:4px; width:16px; height:16px;
    border-radius:50%; border:none; background:rgba(255,255,255,0.1); color:#94A3B8;
    font-size:10px; cursor:pointer; line-height:16px; text-align:center;
    flex-shrink:0; }
.tab-btn:hover .del-btn { display:inline-flex; align-items:center; justify-content:center; }
.tab-btn .del-btn:hover { background:#EF4444; color:white; }
.loading-pane { text-align:center; padding:60px 20px; color:var(--grey); font-size:16px; }
.loading-pane .spinner { display:inline-block; width:32px; height:32px;
    border:3px solid var(--border); border-top-color:var(--blue);
    border-radius:50%; animation:spin 0.8s linear infinite; margin-bottom:12px; }
@keyframes spin { to { transform:rotate(360deg); } }
</style>
</head>
<body>
<nav class="sidebar" id="sidebar">
    <div class="sidebar-header">
        <h3>Stock Screener</h3>
        <div class="subtitle">49 stocks</div>
    </div>
    <div class="tab-list"><div class="section-header" id="sec-hdr-nifty50" onclick="toggleSection('nifty50')"><span class="chevron">▼</span>Nifty 50<span class="sec-count">49</span></div>
<div class="section-body" id="sec-body-nifty50" style="max-height:9999px">
<button class="tab-btn active" data-ticker="RELIANCE" onclick="loadStock('RELIANCE')"><span class="ticker-name">RELIANCE</span><span class="price-sm">₹1,394</span> <span class="grade-badge" style="background:#F59E0B">B</span><span class="del-btn" onclick="removeTab('RELIANCE', event)">&times;</span></button>
<button class="tab-btn" data-ticker="TCS" onclick="loadStock('TCS')"><span class="ticker-name">TCS</span><span class="price-sm">₹2,637</span> <span class="grade-badge" style="background:#22C55E">A</span><span class="del-btn" onclick="removeTab('TCS', event)">&times;</span></button>
<button class="tab-btn" data-ticker="HDFCBANK" onclick="loadStock('HDFCBANK')"><span class="ticker-name">HDFCBANK</span><span class="price-sm">₹888</span> <span class="grade-badge" style="background:#F59E0B">B+</span><span class="del-btn" onclick="removeTab('HDFCBANK', event)">&times;</span></button>
<button class="tab-btn" data-ticker="ICICIBANK" onclick="loadStock('ICICIBANK')"><span class="ticker-name">ICICIBANK</span><span class="price-sm">₹1,379</span> <span class="grade-badge" style="background:#F59E0B">B+</span><span class="del-btn" onclick="removeTab('ICICIBANK', event)">&times;</span></button>
<button class="tab-btn" data-ticker="INFY" onclick="loadStock('INFY')"><span class="ticker-name">INFY</span><span class="price-sm">₹1,300</span> <span class="grade-badge" style="background:#22C55E">A</span><span class="del-btn" onclick="removeTab('INFY', event)">&times;</span></button>
<button class="tab-btn" data-ticker="HINDUNILVR" onclick="loadStock('HINDUNILVR')"><span class="ticker-name">HINDUNILVR</span><span class="price-sm">₹2,338</span> <span class="grade-badge" style="background:#22C55E">A</span><span class="del-btn" onclick="removeTab('HINDUNILVR', event)">&times;</span></button>
<button class="tab-btn" data-ticker="ITC" onclick="loadStock('ITC')"><span class="ticker-name">ITC</span><span class="price-sm">₹314</span> <span class="grade-badge" style="background:#22C55E">A</span><span class="del-btn" onclick="removeTab('ITC', event)">&times;</span></button>
<button class="tab-btn" data-ticker="SBIN" onclick="loadStock('SBIN')"><span class="ticker-name">SBIN</span><span class="price-sm">₹1,202</span> <span class="grade-badge" style="background:#F59E0B">B+</span><span class="del-btn" onclick="removeTab('SBIN', event)">&times;</span></button>
<button class="tab-btn" data-ticker="BHARTIARTL" onclick="loadStock('BHARTIARTL')"><span class="ticker-name">BHARTIARTL</span><span class="price-sm">₹1,879</span> <span class="grade-badge" style="background:#F59E0B">B</span><span class="del-btn" onclick="removeTab('BHARTIARTL', event)">&times;</span></button>
<button class="tab-btn" data-ticker="LT" onclick="loadStock('LT')"><span class="ticker-name">LT</span><span class="price-sm">₹4,278</span> <span class="grade-badge" style="background:#F59E0B">B+</span><span class="del-btn" onclick="removeTab('LT', event)">&times;</span></button>
<button class="tab-btn" data-ticker="KOTAKBANK" onclick="loadStock('KOTAKBANK')"><span class="ticker-name">KOTAKBANK</span><span class="price-sm">₹415</span> <span class="grade-badge" style="background:#F59E0B">B+</span><span class="del-btn" onclick="removeTab('KOTAKBANK', event)">&times;</span></button>
<button class="tab-btn" data-ticker="AXISBANK" onclick="loadStock('AXISBANK')"><span class="ticker-name">AXISBANK</span><span class="price-sm">₹1,384</span> <span class="grade-badge" style="background:#F59E0B">B</span><span class="del-btn" onclick="removeTab('AXISBANK', event)">&times;</span></button>
<button class="tab-btn" data-ticker="BAJFINANCE" onclick="loadStock('BAJFINANCE')"><span class="ticker-name">BAJFINANCE</span><span class="price-sm">₹996</span> <span class="grade-badge" style="background:#F59E0B">B+</span><span class="del-btn" onclick="removeTab('BAJFINANCE', event)">&times;</span></button>
<button class="tab-btn" data-ticker="MARUTI" onclick="loadStock('MARUTI')"><span class="ticker-name">MARUTI</span><span class="price-sm">₹14,857</span> <span class="grade-badge" style="background:#22C55E">A</span><span class="del-btn" onclick="removeTab('MARUTI', event)">&times;</span></button>
<button class="tab-btn" data-ticker="HCLTECH" onclick="loadStock('HCLTECH')"><span class="ticker-name">HCLTECH</span><span class="price-sm">₹1,389</span> <span class="grade-badge" style="background:#22C55E">A</span><span class="del-btn" onclick="removeTab('HCLTECH', event)">&times;</span></button>
<button class="tab-btn" data-ticker="TITAN" onclick="loadStock('TITAN')"><span class="ticker-name">TITAN</span><span class="price-sm">₹4,328</span> <span class="grade-badge" style="background:#F59E0B">B+</span><span class="del-btn" onclick="removeTab('TITAN', event)">&times;</span></button>
<button class="tab-btn" data-ticker="SUNPHARMA" onclick="loadStock('SUNPHARMA')"><span class="ticker-name">SUNPHARMA</span><span class="price-sm">₹1,737</span> <span class="grade-badge" style="background:#10B981">A+</span><span class="del-btn" onclick="removeTab('SUNPHARMA', event)">&times;</span></button>
<button class="tab-btn" data-ticker="NTPC" onclick="loadStock('NTPC')"><span class="ticker-name">NTPC</span><span class="price-sm">₹382</span> <span class="grade-badge" style="background:#EF4444">C</span><span class="del-btn" onclick="removeTab('NTPC', event)">&times;</span></button>
<button class="tab-btn" data-ticker="ADANIENT" onclick="loadStock('ADANIENT')"><span class="ticker-name">ADANIENT</span><span class="price-sm">₹2,162</span> <span class="grade-badge" style="background:#EF4444">C</span><span class="del-btn" onclick="removeTab('ADANIENT', event)">&times;</span></button>
<button class="tab-btn" data-ticker="POWERGRID" onclick="loadStock('POWERGRID')"><span class="ticker-name">POWERGRID</span><span class="price-sm">₹299</span> <span class="grade-badge" style="background:#EF4444">C</span><span class="del-btn" onclick="removeTab('POWERGRID', event)">&times;</span></button>
<button class="tab-btn" data-ticker="ULTRACEMCO" onclick="loadStock('ULTRACEMCO')"><span class="ticker-name">ULTRACEMCO</span><span class="price-sm">₹12,677</span> <span class="grade-badge" style="background:#EF4444">C</span><span class="del-btn" onclick="removeTab('ULTRACEMCO', event)">&times;</span></button>
<button class="tab-btn" data-ticker="ASIANPAINT" onclick="loadStock('ASIANPAINT')"><span class="ticker-name">ASIANPAINT</span><span class="price-sm">₹2,376</span> <span class="grade-badge" style="background:#22C55E">A</span><span class="del-btn" onclick="removeTab('ASIANPAINT', event)">&times;</span></button>
<button class="tab-btn" data-ticker="BAJAJFINSV" onclick="loadStock('BAJAJFINSV')"><span class="ticker-name">BAJAJFINSV</span><span class="price-sm">₹1,993</span> <span class="grade-badge" style="background:#EF4444">C</span><span class="del-btn" onclick="removeTab('BAJAJFINSV', event)">&times;</span></button>
<button class="tab-btn" data-ticker="COALINDIA" onclick="loadStock('COALINDIA')"><span class="ticker-name">COALINDIA</span><span class="price-sm">₹431</span> <span class="grade-badge" style="background:#22C55E">A</span><span class="del-btn" onclick="removeTab('COALINDIA', event)">&times;</span></button>
<button class="tab-btn" data-ticker="WIPRO" onclick="loadStock('WIPRO')"><span class="ticker-name">WIPRO</span><span class="price-sm">₹201</span> <span class="grade-badge" style="background:#F59E0B">B+</span><span class="del-btn" onclick="removeTab('WIPRO', event)">&times;</span></button>
<button class="tab-btn" data-ticker="NESTLEIND" onclick="loadStock('NESTLEIND')"><span class="ticker-name">NESTLEIND</span><span class="price-sm">₹1,292</span> <span class="grade-badge" style="background:#F59E0B">B</span><span class="del-btn" onclick="removeTab('NESTLEIND', event)">&times;</span></button>
<button class="tab-btn" data-ticker="ONGC" onclick="loadStock('ONGC')"><span class="ticker-name">ONGC</span><span class="price-sm">₹280</span> <span class="grade-badge" style="background:#F59E0B">B+</span><span class="del-btn" onclick="removeTab('ONGC', event)">&times;</span></button>
<button class="tab-btn" data-ticker="JSWSTEEL" onclick="loadStock('JSWSTEEL')"><span class="ticker-name">JSWSTEEL</span><span class="price-sm">₹1,265</span> <span class="grade-badge" style="background:#EF4444">C</span><span class="del-btn" onclick="removeTab('JSWSTEEL', event)">&times;</span></button>
<button class="tab-btn" data-ticker="TATASTEEL" onclick="loadStock('TATASTEEL')"><span class="ticker-name">TATASTEEL</span><span class="price-sm">₹212</span> <span class="grade-badge" style="background:#DC2626">D</span><span class="del-btn" onclick="removeTab('TATASTEEL', event)">&times;</span></button>
<button class="tab-btn" data-ticker="ADANIPORTS" onclick="loadStock('ADANIPORTS')"><span class="ticker-name">ADANIPORTS</span><span class="price-sm">₹1,521</span> <span class="grade-badge" style="background:#F59E0B">B+</span><span class="del-btn" onclick="removeTab('ADANIPORTS', event)">&times;</span></button>
<button class="tab-btn" data-ticker="CIPLA" onclick="loadStock('CIPLA')"><span class="ticker-name">CIPLA</span><span class="price-sm">₹1,348</span> <span class="grade-badge" style="background:#22C55E">A</span><span class="del-btn" onclick="removeTab('CIPLA', event)">&times;</span></button>
<button class="tab-btn" data-ticker="DRREDDY" onclick="loadStock('DRREDDY')"><span class="ticker-name">DRREDDY</span><span class="price-sm">₹1,286</span> <span class="grade-badge" style="background:#F59E0B">B+</span><span class="del-btn" onclick="removeTab('DRREDDY', event)">&times;</span></button>
<button class="tab-btn" data-ticker="GRASIM" onclick="loadStock('GRASIM')"><span class="ticker-name">GRASIM</span><span class="price-sm">₹2,800</span> <span class="grade-badge" style="background:#DC2626">D</span><span class="del-btn" onclick="removeTab('GRASIM', event)">&times;</span></button>
<button class="tab-btn" data-ticker="TECHM" onclick="loadStock('TECHM')"><span class="ticker-name">TECHM</span><span class="price-sm">₹1,358</span> <span class="grade-badge" style="background:#F59E0B">B</span><span class="del-btn" onclick="removeTab('TECHM', event)">&times;</span></button>
<button class="tab-btn" data-ticker="DIVISLAB" onclick="loadStock('DIVISLAB')"><span class="ticker-name">DIVISLAB</span><span class="price-sm">₹6,408</span> <span class="grade-badge" style="background:#F59E0B">B+</span><span class="del-btn" onclick="removeTab('DIVISLAB', event)">&times;</span></button>
<button class="tab-btn" data-ticker="APOLLOHOSP" onclick="loadStock('APOLLOHOSP')"><span class="ticker-name">APOLLOHOSP</span><span class="price-sm">₹7,822</span> <span class="grade-badge" style="background:#F59E0B">B+</span><span class="del-btn" onclick="removeTab('APOLLOHOSP', event)">&times;</span></button>
<button class="tab-btn" data-ticker="EICHERMOT" onclick="loadStock('EICHERMOT')"><span class="ticker-name">EICHERMOT</span><span class="price-sm">₹8,010</span> <span class="grade-badge" style="background:#10B981">A+</span><span class="del-btn" onclick="removeTab('EICHERMOT', event)">&times;</span></button>
<button class="tab-btn" data-ticker="BPCL" onclick="loadStock('BPCL')"><span class="ticker-name">BPCL</span><span class="price-sm">₹385</span> <span class="grade-badge" style="background:#F59E0B">B</span><span class="del-btn" onclick="removeTab('BPCL', event)">&times;</span></button>
<button class="tab-btn" data-ticker="INDUSINDBK" onclick="loadStock('INDUSINDBK')"><span class="ticker-name">INDUSINDBK</span><span class="price-sm">₹957</span> <span class="grade-badge" style="background:#DC2626">D</span><span class="del-btn" onclick="removeTab('INDUSINDBK', event)">&times;</span></button>
<button class="tab-btn" data-ticker="HINDALCO" onclick="loadStock('HINDALCO')"><span class="ticker-name">HINDALCO</span><span class="price-sm">₹925</span> <span class="grade-badge" style="background:#F59E0B">B+</span><span class="del-btn" onclick="removeTab('HINDALCO', event)">&times;</span></button>
<button class="tab-btn" data-ticker="HEROMOTOCO" onclick="loadStock('HEROMOTOCO')"><span class="ticker-name">HEROMOTOCO</span><span class="price-sm">₹5,710</span> <span class="grade-badge" style="background:#22C55E">A</span><span class="del-btn" onclick="removeTab('HEROMOTOCO', event)">&times;</span></button>
<button class="tab-btn" data-ticker="SBILIFE" onclick="loadStock('SBILIFE')"><span class="ticker-name">SBILIFE</span><span class="price-sm">₹2,037</span> <span class="grade-badge" style="background:#F59E0B">B+</span><span class="del-btn" onclick="removeTab('SBILIFE', event)">&times;</span></button>
<button class="tab-btn" data-ticker="HDFCLIFE" onclick="loadStock('HDFCLIFE')"><span class="ticker-name">HDFCLIFE</span><span class="price-sm">₹715</span> <span class="grade-badge" style="background:#EF4444">C</span><span class="del-btn" onclick="removeTab('HDFCLIFE', event)">&times;</span></button>
<button class="tab-btn" data-ticker="TATACONSUM" onclick="loadStock('TATACONSUM')"><span class="ticker-name">TATACONSUM</span><span class="price-sm">₹1,141</span> <span class="grade-badge" style="background:#EF4444">C</span><span class="del-btn" onclick="removeTab('TATACONSUM', event)">&times;</span></button>
<button class="tab-btn" data-ticker="BRITANNIA" onclick="loadStock('BRITANNIA')"><span class="ticker-name">BRITANNIA</span><span class="price-sm">₹6,002</span> <span class="grade-badge" style="background:#F59E0B">B+</span><span class="del-btn" onclick="removeTab('BRITANNIA', event)">&times;</span></button>
<button class="tab-btn" data-ticker="BAJAJ-AUTO" onclick="loadStock('BAJAJ-AUTO')"><span class="ticker-name">BAJAJ-AUTO</span><span class="price-sm">₹9,972</span> <span class="grade-badge" style="background:#22C55E">A</span><span class="del-btn" onclick="removeTab('BAJAJ-AUTO', event)">&times;</span></button>
<button class="tab-btn" data-ticker="M&M" onclick="loadStock('M&M')"><span class="ticker-name">M&M</span><span class="price-sm">₹3,397</span> <span class="grade-badge" style="background:#F59E0B">B</span><span class="del-btn" onclick="removeTab('M&M', event)">&times;</span></button>
<button class="tab-btn" data-ticker="SHRIRAMFIN" onclick="loadStock('SHRIRAMFIN')"><span class="ticker-name">SHRIRAMFIN</span><span class="price-sm">₹1,079</span> <span class="grade-badge" style="background:#F59E0B">B+</span><span class="del-btn" onclick="removeTab('SHRIRAMFIN', event)">&times;</span></button>
<button class="tab-btn" data-ticker="LTIM" onclick="loadStock('LTIM')"><span class="ticker-name">LTIM</span><span class="price-sm">₹3,434</span> <span class="grade-badge" style="background:#10B981">A+</span><span class="del-btn" onclick="removeTab('LTIM', event)">&times;</span></button>
</div>
</div>
    <div class="add-symbol">
        <input type="text" id="add-symbol-input" placeholder="Search stocks..."
               onkeydown="handleSymbolInput(event)">
        <div id="ac-dropdown" class="ac-dropdown"></div>
        <div class="hint">Type ticker or company name, ↑↓ to navigate</div>
    </div>
</nav>
<button class="sidebar-toggle" onclick="toggleSidebar()" title="Toggle sidebar">&#9776;</button>
<div class="main-container" id="main-container">
    <div class="loading-pane" id="initial-loader">
        <div class="spinner"></div><br>Loading RELIANCE...
    </div>
</div>
<script>
var _stockIndex = [{"ticker": "RELIANCE", "name": "Reliance Industries Ltd", "price": "₹1,394", "grade": "B", "grade_color": "#F59E0B"}, {"ticker": "TCS", "name": "Tata Consultancy Services Ltd", "price": "₹2,637", "grade": "A", "grade_color": "#22C55E"}, {"ticker": "HDFCBANK", "name": "HDFC Bank Ltd", "price": "₹888", "grade": "B+", "grade_color": "#F59E0B"}, {"ticker": "ICICIBANK", "name": "ICICI Bank Ltd", "price": "₹1,379", "grade": "B+", "grade_color": "#F59E0B"}, {"ticker": "INFY", "name": "Infosys Ltd", "price": "₹1,300", "grade": "A", "grade_color": "#22C55E"}, {"ticker": "HINDUNILVR", "name": "Hindustan Unilever Ltd", "price": "₹2,338", "grade": "A", "grade_color": "#22C55E"}, {"ticker": "ITC", "name": "ITC Ltd", "price": "₹314", "grade": "A", "grade_color": "#22C55E"}, {"ticker": "SBIN", "name": "State Bank of India", "price": "₹1,202", "grade": "B+", "grade_color": "#F59E0B"}, {"ticker": "BHARTIARTL", "name": "Bharti Airtel Ltd", "price": "₹1,879", "grade": "B", "grade_color": "#F59E0B"}, {"ticker": "LT", "name": "Larsen & Toubro Ltd", "price": "₹4,278", "grade": "B+", "grade_color": "#F59E0B"}, {"ticker": "KOTAKBANK", "name": "Kotak Mahindra Bank Ltd", "price": "₹415", "grade": "B+", "grade_color": "#F59E0B"}, {"ticker": "AXISBANK", "name": "Axis Bank Ltd", "price": "₹1,384", "grade": "B", "grade_color": "#F59E0B"}, {"ticker": "BAJFINANCE", "name": "Bajaj Finance Ltd", "price": "₹996", "grade": "B+", "grade_color": "#F59E0B"}, {"ticker": "MARUTI", "name": "Maruti Suzuki India Ltd", "price": "₹14,857", "grade": "A", "grade_color": "#22C55E"}, {"ticker": "HCLTECH", "name": "HCL Technologies Ltd", "price": "₹1,389", "grade": "A", "grade_color": "#22C55E"}, {"ticker": "TITAN", "name": "Titan Company Ltd", "price": "₹4,328", "grade": "B+", "grade_color": "#F59E0B"}, {"ticker": "SUNPHARMA", "name": "Sun Pharmaceutical Industries Ltd", "price": "₹1,737", "grade": "A+", "grade_color": "#10B981"}, {"ticker": "NTPC", "name": "NTPC Ltd", "price": "₹382", "grade": "C", "grade_color": "#EF4444"}, {"ticker": "ADANIENT", "name": "Adani Enterprises Ltd", "price": "₹2,162", "grade": "C", "grade_color": "#EF4444"}, {"ticker": "POWERGRID", "name": "Power Grid Corporation of India Ltd", "price": "₹299", "grade": "C", "grade_color": "#EF4444"}, {"ticker": "ULTRACEMCO", "name": "UltraTech Cement Ltd", "price": "₹12,677", "grade": "C", "grade_color": "#EF4444"}, {"ticker": "ASIANPAINT", "name": "Asian Paints Ltd", "price": "₹2,376", "grade": "A", "grade_color": "#22C55E"}, {"ticker": "BAJAJFINSV", "name": "Bajaj Finserv Ltd", "price": "₹1,993", "grade": "C", "grade_color": "#EF4444"}, {"ticker": "COALINDIA", "name": "Coal India Ltd", "price": "₹431", "grade": "A", "grade_color": "#22C55E"}, {"ticker": "WIPRO", "name": "Wipro Ltd", "price": "₹201", "grade": "B+", "grade_color": "#F59E0B"}, {"ticker": "NESTLEIND", "name": "Nestle India Ltd", "price": "₹1,292", "grade": "B", "grade_color": "#F59E0B"}, {"ticker": "ONGC", "name": "Oil & Natural Gas Corpn Ltd", "price": "₹280", "grade": "B+", "grade_color": "#F59E0B"}, {"ticker": "JSWSTEEL", "name": "JSW Steel Ltd", "price": "₹1,265", "grade": "C", "grade_color": "#EF4444"}, {"ticker": "TATASTEEL", "name": "Tata Steel Ltd", "price": "₹212", "grade": "D", "grade_color": "#DC2626"}, {"ticker": "ADANIPORTS", "name": "Adani Ports & Special Economic Zone Ltd", "price": "₹1,521", "grade": "B+", "grade_color": "#F59E0B"}, {"ticker": "CIPLA", "name": "Cipla Ltd", "price": "₹1,348", "grade": "A", "grade_color": "#22C55E"}, {"ticker": "DRREDDY", "name": "Dr Reddys Laboratories Ltd", "price": "₹1,286", "grade": "B+", "grade_color": "#F59E0B"}, {"ticker": "GRASIM", "name": "Grasim Industries Ltd", "price": "₹2,800", "grade": "D", "grade_color": "#DC2626"}, {"ticker": "TECHM", "name": "Tech Mahindra Ltd", "price": "₹1,358", "grade": "B", "grade_color": "#F59E0B"}, {"ticker": "DIVISLAB", "name": "Divis Laboratories Ltd", "price": "₹6,408", "grade": "B+", "grade_color": "#F59E0B"}, {"ticker": "APOLLOHOSP", "name": "Apollo Hospitals Enterprise Ltd", "price": "₹7,822", "grade": "B+", "grade_color": "#F59E0B"}, {"ticker": "EICHERMOT", "name": "Eicher Motors Ltd", "price": "₹8,010", "grade": "A+", "grade_color": "#10B981"}, {"ticker": "BPCL", "name": "Bharat Petroleum Corporation Ltd", "price": "₹385", "grade": "B", "grade_color": "#F59E0B"}, {"ticker": "INDUSINDBK", "name": "IndusInd Bank Ltd", "price": "₹957", "grade": "D", "grade_color": "#DC2626"}, {"ticker": "HINDALCO", "name": "Hindalco Industries Ltd", "price": "₹925", "grade": "B+", "grade_color": "#F59E0B"}, {"ticker": "HEROMOTOCO", "name": "Hero MotoCorp Ltd", "price": "₹5,710", "grade": "A", "grade_color": "#22C55E"}, {"ticker": "SBILIFE", "name": "SBI Life Insurance Company Ltd", "price": "₹2,037", "grade": "B+", "grade_color": "#F59E0B"}, {"ticker": "HDFCLIFE", "name": "HDFC Life Insurance Company Ltd", "price": "₹715", "grade": "C", "grade_color": "#EF4444"}, {"ticker": "TATACONSUM", "name": "Tata Consumer Products Ltd", "price": "₹1,141", "grade": "C", "grade_color": "#EF4444"}, {"ticker": "BRITANNIA", "name": "Britannia Industries Ltd", "price": "₹6,002", "grade": "B+", "grade_color": "#F59E0B"}, {"ticker": "BAJAJ-AUTO", "name": "Bajaj Auto Ltd", "price": "₹9,972", "grade": "A", "grade_color": "#22C55E"}, {"ticker": "M&M", "name": "Mahindra & Mahindra Ltd", "price": "₹3,397", "grade": "B", "grade_color": "#F59E0B"}, {"ticker": "SHRIRAMFIN", "name": "Shriram Finance Ltd", "price": "₹1,079", "grade": "B+", "grade_color": "#F59E0B"}, {"ticker": "LTIM", "name": "Mindtree Ltd(Merged)", "price": "₹3,434", "grade": "A+", "grade_color": "#10B981"}];
var _loadedPanes = {};  // ticker -> true (already fetched)
var _acTimer = null, _acIdx = -1, _acItems = [];

// ── Load a stock pane on demand ──
function loadStock(ticker) {
    // Highlight the tab
    document.querySelectorAll('.tab-btn').forEach(function(b) { b.classList.remove('active'); });
    document.querySelectorAll('.tab-btn').forEach(function(b) {
        if (b.dataset.ticker === ticker) b.classList.add('active');
    });

    // If already loaded, just show it
    var existing = document.getElementById('pane-' + ticker);
    if (existing) {
        document.querySelectorAll('.tab-pane').forEach(function(p) { p.style.display = 'none'; });
        existing.style.display = 'block';
        setTimeout(function() {
            existing.querySelectorAll('.js-plotly-plot').forEach(function(p) {
                if (window.Plotly) Plotly.Plots.resize(p);
            });
        }, 150);
        existing.scrollIntoView({behavior:'smooth', block:'start'});
        return;
    }

    // Show loading state
    var container = document.getElementById('main-container');
    document.querySelectorAll('.tab-pane').forEach(function(p) { p.style.display = 'none'; });
    var loader = document.getElementById('initial-loader');
    if (!loader) {
        loader = document.createElement('div');
        loader.className = 'loading-pane';
        loader.id = 'initial-loader';
        container.appendChild(loader);
    }
    loader.innerHTML = '<div class="spinner"></div><br>Loading ' + ticker + '...';
    loader.style.display = 'block';

    // Fetch the pane HTML fragment
    fetch('panes/' + ticker + '.html')
        .then(function(r) {
            if (!r.ok) throw new Error('Not found');
            return r.text();
        })
        .then(function(html) {
            loader.style.display = 'none';
            // Insert the pane (it comes with its own div.tab-pane wrapper)
            var wrapper = document.createElement('div');
            wrapper.innerHTML = html;
            var pane = wrapper.firstElementChild;
            pane.style.display = 'block';
            container.appendChild(pane);
            _loadedPanes[ticker] = true;
            // Execute deferred Plotly scripts
            var scripts = pane.querySelectorAll('script[type="text/plotly-deferred"]');
            scripts.forEach(function(s) {
                var ns = document.createElement('script');
                ns.textContent = s.textContent;
                s.parentNode.replaceChild(ns, s);
            });
            // Also execute any regular inline scripts (from Plotly to_html)
            var regularScripts = pane.querySelectorAll('script:not([type])');
            regularScripts.forEach(function(s) {
                var ns = document.createElement('script');
                ns.textContent = s.textContent;
                s.parentNode.replaceChild(ns, s);
            });
            setTimeout(function() {
                pane.querySelectorAll('.js-plotly-plot').forEach(function(p) {
                    if (window.Plotly) Plotly.Plots.resize(p);
                });
            }, 300);
        })
        .catch(function(err) {
            loader.innerHTML = '<div style="color:#EF4444">Failed to load ' + ticker + ': ' + err.message + '</div>' +
                '<p style="margin-top:12px"><a href="https://www.screener.in/company/' + ticker + '/" target="_blank" style="color:#3B82F6">View on screener.in \u2192</a></p>';
        });
}

function switchPeriod(ticker, period) {
    var pane = document.getElementById('pane-' + ticker);
    if (!pane) return;
    pane.querySelectorAll('.price-period').forEach(function(d) { d.style.display = 'none'; });
    var target = document.getElementById(ticker + '-' + period);
    if (target) target.style.display = 'block';
    var bar = document.getElementById('pbar-' + ticker);
    if (bar) bar.querySelectorAll('.period-btn').forEach(function(b) {
        b.classList.toggle('active', b.dataset.period === period);
    });
    setTimeout(function() {
        if (!target) return;
        target.querySelectorAll('.js-plotly-plot').forEach(function(p) {
            if (window.Plotly) { Plotly.Plots.resize(p); Plotly.relayout(p, { autosize: true }); }
        });
    }, 50);
}

function toggleSidebar() {
    document.body.classList.toggle('sidebar-collapsed');
    setTimeout(function() {
        document.querySelectorAll('.js-plotly-plot').forEach(function(p) {
            if (window.Plotly && p.offsetParent !== null) Plotly.Plots.resize(p);
        });
    }, 300);
}

function toggleSection(id) {
    var hdr = document.getElementById('sec-hdr-' + id);
    var body = document.getElementById('sec-body-' + id);
    if (!hdr || !body) return;
    hdr.classList.toggle('collapsed');
    body.classList.toggle('collapsed');
}

function removeTab(ticker, evt) {
    evt.stopPropagation();
    var pane = document.getElementById('pane-' + ticker);
    var btn = document.querySelector('.tab-btn[data-ticker="' + ticker + '"]');
    var wasActive = btn && btn.classList.contains('active');
    if (pane) pane.remove();
    if (btn) btn.remove();
    delete _loadedPanes[ticker];
    if (wasActive) {
        var first = document.querySelector('.tab-btn');
        if (first) loadStock(first.dataset.ticker);
    }
}

// ── Client-side autocomplete from pre-built stock index ──
function showAC(items) {
    var dd = document.getElementById('ac-dropdown');
    if (!items || !items.length) { hideAC(); return; }
    _acItems = items;
    _acIdx = -1;
    dd.innerHTML = '';
    items.forEach(function(item, idx) {
        var div = document.createElement('div');
        div.className = 'ac-item';
        div.innerHTML = '<span class="ac-ticker">' + item.ticker + '</span><span class="ac-name">' + (item.name||'') + '</span>';
        div.onmousedown = function(e) { e.preventDefault(); loadStock(item.ticker); hideAC(); document.getElementById('add-symbol-input').value = ''; };
        div.onmouseover = function() { highlightAC(idx); };
        dd.appendChild(div);
    });
    dd.style.display = 'block';
}
function hideAC() {
    var dd = document.getElementById('ac-dropdown');
    if (dd) dd.style.display = 'none';
    _acIdx = -1; _acItems = [];
}
function highlightAC(idx) {
    var dd = document.getElementById('ac-dropdown');
    var items = dd.querySelectorAll('.ac-item');
    items.forEach(function(el, i) { el.classList.toggle('highlighted', i === idx); });
    _acIdx = idx;
}

function handleSymbolInput(e) {
    var input = e.target;
    var val = input.value.trim().toUpperCase();
    if (e.key === 'ArrowDown') {
        e.preventDefault();
        if (_acItems.length) highlightAC(Math.min(_acIdx + 1, _acItems.length - 1));
        return;
    }
    if (e.key === 'ArrowUp') {
        e.preventDefault();
        if (_acItems.length) highlightAC(Math.max(_acIdx - 1, 0));
        return;
    }
    if (e.key === 'Enter') {
        e.preventDefault();
        if (_acIdx >= 0 && _acItems[_acIdx]) {
            loadStock(_acItems[_acIdx].ticker);
        } else if (val) {
            loadStock(val.replace(/[^A-Z0-9&-]/g, ''));
        }
        hideAC();
        input.value = '';
        return;
    }
    if (e.key === 'Escape') { hideAC(); return; }

    // Debounced local search through stock index
    clearTimeout(_acTimer);
    if (val.length < 1) { hideAC(); return; }
    _acTimer = setTimeout(function() {
        var q = val.toLowerCase();
        var matches = _stockIndex.filter(function(s) {
            return s.ticker.toLowerCase().indexOf(q) >= 0 ||
                   s.name.toLowerCase().indexOf(q) >= 0;
        }).slice(0, 10);
        showAC(matches);
    }, 100);
}

// ── Keyboard navigation for stock tabs ──
document.addEventListener('keydown', function(e) {
    if (e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA') return;
    if (e.key !== 'ArrowUp' && e.key !== 'ArrowDown') return;
    e.preventDefault();
    var btns = Array.from(document.querySelectorAll('.tab-btn'));
    if (!btns.length) return;
    var activeIdx = btns.findIndex(function(b) { return b.classList.contains('active'); });
    if (e.key === 'ArrowDown') {
        activeIdx = (activeIdx + 1) % btns.length;
    } else {
        activeIdx = (activeIdx - 1 + btns.length) % btns.length;
    }
    loadStock(btns[activeIdx].dataset.ticker);
    btns[activeIdx].scrollIntoView({ block: 'nearest' });
});

// Close autocomplete when clicking outside
document.addEventListener('click', function(e) {
    if (!e.target.closest('.add-symbol')) hideAC();
});

// ── Load first stock on page load ──
(function() {
    if (_stockIndex.length > 0) {
        loadStock(_stockIndex[0].ticker);
    }
})();
</script>
</body>
</html>